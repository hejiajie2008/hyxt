<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jfxy.dao.GoodsclassDao" >
  <!--映射返回值-->
  <resultMap id="ResultMap" type="com.jfxy.pojo.Goodsclass" >
    <id column="ClassID" property="classid"  />
     <result column="ClassName" property="classname"  />
     <result column="ClassRemark" property="classremark"  />
     <result column="ParentID" property="parentid"  />
     <result column="CreateShopID" property="createshopid"  />
  </resultMap>
  <!--where 条件组装-->
  
  <sql id="Where_Clause" >
    <where >
     	
     	
     	
     	
		      <if test="classname != null" >
		       
		         ClassName = #{classname} 
		      </if>
     	
     	
		      <if test="classremark != null" >
		       
		         and ClassRemark = #{classremark} 
		      </if>
     	
     	
		      <if test="parentid != null" >
		       
		         and ParentID = #{parentid} 
		      </if>
     	
     	
		      <if test="createshopid != null" >
		       
		         and CreateShopID = #{createshopid} 
		      </if>
		      
		      
    </where>
  </sql>
  
  <sql id="Where_Clause_Autho" >
    <where >
     	
     	
     	
     	
		      <if test="classname != null" >
		       
		         ClassName = #{classname} 
		      </if>
     	
     	
		      <if test="classremark != null" >
		       
		         and ClassRemark = #{classremark} 
		      </if>
     	
     	
		      <if test="parentid != null" >
		       
		         and ParentID = #{parentid} 
		      </if>
     	
     	
		      <if test="createshopid != null" >
		       
		         and CreateShopID = #{createshopid} 
		      </if>
		      
		      <if test="goodclassshopid!=null">
	    	 and GoodsClassAuthority.shopid = #{goodclassshopid}
		    
			
			
	   			 </if>
    </where>
  </sql>

 <!--基本列-->
  <sql id="Base_Column_List" >
 goodsclass.ClassID,ClassName,ClassRemark,ParentID,CreateShopID    
  </sql>
  
  
  <!--添加数据-->
  <insert id="insert" parameterType="com.jfxy.pojo.Goodsclass" useGeneratedKeys="true" keyProperty="classid">
    insert into goodsclass (ClassID,ClassName,ClassRemark,ParentID,CreateShopID)values (#{classid},#{classname},#{classremark},#{parentid},#{createshopid})
  </insert>
  
  
  <!--修改数据-->
  <update id="update" parameterType="com.jfxy.pojo.Goodsclass" >
    update goodsclass
    <set >
	      <if test="classname != null" >
	        ClassName = #{classname},
	      </if>
	      <if test="classremark != null" >
	        ClassRemark = #{classremark},
	      </if>
	      <if test="parentid != null" >
	        ParentID = #{parentid},
	      </if>
	      <if test="createshopid != null" >
	        CreateShopID = #{createshopid},
	      </if>
    </set>
    where  ClassID= #{classid}
  </update>
  
  
   <!--批量删除的方法-->
   <delete id="deleteById" parameterType="int" >
    delete from goodsclass
    where  ClassID=#{value}
  </delete>
  
  
  	<!--批量删除的方法-->
   <delete id="deleteByIds" parameterType="map" >
    delete from goodsclass
    where  ClassID in (
    <foreach collection="Ids" item="item" index="index" separator=",">
		#{item}
	</foreach>
	)
  </delete>
  
  
  
  	<!-- 查询总记录数 -->
	<select id="count" parameterType="com.jfxy.pojo.form.GoodsclassFormBean" resultType="int">
		SELECT COUNT(*) FROM goodsclass
		
		<include refid="Where_Clause" />
	</select>
  
 	 <!-- 按条件查询结果集(带分页) -->
	<select id="pageList" parameterType="com.jfxy.pojo.form.GoodsclassFormBean" resultMap="ResultMap">
		SELECT  <include refid="Base_Column_List" />
		 FROM goodsclass right join GoodsClassAuthority on GoodsClassAuthority.classid=goodsclass.classId
		 
		 <if test="_parameter != null" >
		<include refid="Where_Clause_Autho" />
		  
		  LIMIT #{firstResult},#{pageSize}
		  </if>
	</select>
  
 	 <!-- 按条件查询结果集(不带分页) -->
	<select id="list" parameterType="com.jfxy.pojo.Goodsclass" resultMap="ResultMap">
		SELECT 
		 <include refid="Base_Column_List" />
		  FROM goodsclass
		 <if test="_parameter != null" >
			<include refid="Where_Clause" />
		</if>
		  
		
	</select>
	
	

  <!--删除分类-->
   <delete id="deleteByGoodsShopId" parameterType="map" >
    delete from GoodsClassAuthority
    where  ClassID=#{classid}
    and ShopID=#{shopid}
  </delete>
  
  <!--删除分类-->
   <delete id="deleteByShopId" parameterType="map" >
    delete from goodsclass
    where  ClassID=#{classid}
    and CreateShopID=#{shopid}
    and ClassID not in
    
    (select classid from GoodsClassAuthority)
    
  </delete>
  
  
  
 
  
  
   <resultMap id="levelRebatMap" type="com.jfxy.pojo.GoodsClassRebat" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 30 16:11:47 CST 2015.
    -->
    <result column="classdiscountid" property="classdiscountid" />
    <result column="classdiscountpercent" property="classdiscountpercent"  />
    <result column="classpointpercent" property="classpointpercent"  />
    <result column="levelname" property="levelname"  />
    
  </resultMap>
  
  
  
  <insert id="insertClassAutho" parameterType="map">
  insert into GoodsClassAuthority(classid,shopid) values(#{classid},#{shopid})
  </insert>



<!-- 按条件查询结果集 -->
	<select id="findbyId" parameterType="int" resultMap="ResultMap">
		SELECT 
		 <include refid="Base_Column_List" />
		  FROM goodsclass
		where  classID= #{value}
		  
		
	</select>
	
	<select id="findclassrebate" resultMap="levelRebatMap" parameterType="map">
	 	 select goodsclassdiscount.classdiscountid,goodsclassdiscount.classdiscountpercent,goodsclassdiscount.classpointpercent,memlevel.levelname from goodsclassdiscount
	  left join  memlevel on goodsclassdiscount.memlevelid=memlevel.levelid
	   where discountshopid=#{shopid} and goodsclassid=#{classid}
	</select>
	
	<!--添加数据折扣率-->
  <insert id="insertclassRebat" parameterType="com.jfxy.pojo.GoodsClassRebat" >
    insert into goodsclassdiscount (goodsclassid,MemLevelID,DiscountShopID,ClassDiscountPercent,ClassPointPercent ) values 
    (#{classid},#{memlevelid},#{shopid},#{classdiscountpercent},#{classpointpercent})
  </insert>
  
  
   <update id="updateclassRabat" parameterType="com.jfxy.pojo.GoodsClassRebat" >
  	update goodsclassdiscount set ClassDiscountPercent=#{classdiscountpercent},ClassPointPercent=#{classpointpercent} where classdiscountid=#{classdiscountid}
  </update>
  
  
     <!--批量删除的方法-->
   <delete id="deleteclassRabat" parameterType="com.jfxy.pojo.GoodsClassRebat" >
    delete from goodsclassdiscount
    where   MemLevelID=#{memlevelid} and DiscountShopID=#{shopid}
  </delete>
 
  

</mapper>