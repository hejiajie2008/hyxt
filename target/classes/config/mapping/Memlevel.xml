<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jfxy.dao.MemlevelDao" >
  <!--映射返回值-->
  <resultMap id="ResultMap" type="com.jfxy.pojo.Memlevel" >
    <id column="LevelID" property="levelid"  />
     <result column="LevelName" property="levelname"  />
     <result column="LevelPoint" property="levelpoint"  />
     <result column="LevelDiscountPercent" property="leveldiscountpercent"  />
     <result column="LevelPointPercent" property="levelpointpercent"  />
     <result column="LevellLock" property="levelllock"  />
     <result column="LevelRechargePointRate" property="levelrechargepointrate"  />
  </resultMap>
  <!--where 条件组装-->
  
  <sql id="Where_Clause" >
    <where >
     	
     	
     	
     	
		      <if test="levelname != null" >
		       
		         LevelName = #{levelname} 
		      </if>
     	
     	
		      <if test="levelpoint != null" >
		       
		         and LevelPoint = #{levelpoint} 
		      </if>
     	
     	
		      <if test="leveldiscountpercent != null" >
		       
		         and LevelDiscountPercent = #{leveldiscountpercent} 
		      </if>
     	
     	
		      <if test="levelpointpercent != null" >
		       
		         and LevelPointPercent = #{levelpointpercent} 
		      </if>
     	
     	
		      <if test="levelllock != null" >
		       
		         and LevellLock = #{levelllock} 
		      </if>
     	
     	
		      <if test="levelrechargepointrate != null" >
		       
		         and LevelRechargePointRate = #{levelrechargepointrate} 
		      </if>
    </where>
  </sql>

 <!--基本列-->
  <sql id="Base_Column_List" >
LevelID,LevelName,LevelPoint,LevelDiscountPercent,LevelPointPercent,LevellLock,LevelRechargePointRate    
  </sql>
  
  
  <!--添加数据-->
  <insert id="insert" parameterType="com.jfxy.pojo.Memlevel" useGeneratedKeys="true" keyProperty="levelid" >
    insert into memlevel (LevelName,LevelPoint,LevelDiscountPercent,LevelPointPercent,LevellLock,LevelRechargePointRate)values (#{levelname},#{levelpoint},#{leveldiscountpercent},#{levelpointpercent},#{levelllock},#{levelrechargepointrate})
  </insert>
  
  
  <!--修改数据-->
  <update id="update" parameterType="com.jfxy.pojo.Memlevel" >
    update memlevel
    <set >
	      <if test="levelname != null" >
	        LevelName = #{levelname},
	      </if>
	      <if test="levelpoint != null" >
	        LevelPoint = #{levelpoint},
	      </if>
	      <if test="leveldiscountpercent != null" >
	        LevelDiscountPercent = #{leveldiscountpercent},
	      </if>
	      <if test="levelpointpercent != null" >
	        LevelPointPercent = #{levelpointpercent},
	      </if>
	      <if test="levelllock != null" >
	        LevellLock = #{levelllock},
	      </if>
	      <if test="levelrechargepointrate != null" >
	        LevelRechargePointRate = #{levelrechargepointrate},
	      </if>
    </set>
    where  LevelID= #{levelid}
  </update>
  
  
   <!--批量删除的方法-->
   <delete id="deleteById" parameterType="int" >
    delete from memlevel
    where  LevelID=#{value}
  </delete>
  
  
  	<!--批量删除的方法-->
   <delete id="deleteByIds" parameterType="map" >
    delete from memlevel
    where  LevelID in (
    <foreach collection="Ids" item="item" index="index" separator=",">
		#{item}
	</foreach>
	)
  </delete>
  
  
  
  	<!-- 查询总记录数 -->
	<select id="count" parameterType="com.jfxy.pojo.form.MemlevelFormBean" resultType="int">
		SELECT COUNT(*) FROM memlevel
		
		<include refid="Where_Clause" />
	</select>
  
 	 <!-- 按条件查询结果集(带分页) -->
	<select id="pageList" parameterType="com.jfxy.pojo.form.MemlevelFormBean" resultMap="ResultMap">
		SELECT  <include refid="Base_Column_List" />
		 FROM memlevel
		<include refid="Where_Clause" />
		  
		  LIMIT #{firstResult},#{pageSize}
	</select>
  
 	 <!-- 按条件查询结果集(不带分页) -->
	<select id="list" parameterType="com.jfxy.pojo.Memlevel" resultMap="ResultMap">
		SELECT 
		 <include refid="Base_Column_List" />
		  FROM memlevel
		<include refid="Where_Clause" />
		  
		
	</select>
	
	
	<!-- 按条件查询结果集 -->
	<select id="findbyId" parameterType="int" resultMap="ResultMap">
		SELECT 
		 <include refid="Base_Column_List" />
		  FROM memlevel
		where  LevelID= #{value}
		  
		
	</select>
  
 
  
  <resultMap id="GoodsClassRebatMap" type="com.jfxy.pojo.GoodsClassRebat" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 30 16:11:47 CST 2015.
    -->
    <result column="classdiscountid" property="classdiscountid" />
    <result column="classdiscountpercent" property="classdiscountpercent"  />
    <result column="classpointpercent" property="classpointpercent"  />
    <result column="classname" property="classname"  />
    
  </resultMap>
	
	
	<!-- getUserCount -->
	<select id="queryGoodsClass" resultMap="GoodsClassRebatMap" parameterType="map">
		select classdiscountid, classdiscountpercent,classpointpercent,goodsclass.classname,goodsclass.classid classid from goodsclassdiscount left join goodsclass on  
goodsclassdiscount.goodsclassid=goodsclass.classid 
where discountshopid=#{discountshopid} and memlevelid=#{memlevelid}
	</select>
  
  <select id="queryGoodsClassforA" resultMap="GoodsClassRebatMap" parameterType="map">
 select GoodsClassAuthority.classid,classname from  GoodsClassAuthority left join goodsclass on GoodsClassAuthority.classid=goodsclass.classId
where GoodsClassAuthority.shopid=#{discountshopid}

</select>


	<!--添加数据折扣率-->
  <insert id="insertRebat" parameterType="com.jfxy.pojo.GoodsClassRebat" >
    insert into goodsclassdiscount (goodsclassid,MemLevelID,DiscountShopID,ClassDiscountPercent,ClassPointPercent ) values 
    (#{classid},#{memlevelid},#{shopid},#{classdiscountpercent},#{classpointpercent})
  </insert>
  
  <update id="updateRabat" parameterType="com.jfxy.pojo.GoodsClassRebat" >
  	update goodsclassdiscount set ClassDiscountPercent=#{classdiscountpercent},ClassPointPercent=#{classpointpercent} where classdiscountid=#{classdiscountid}
  </update>
  
  
   <!--批量删除的方法-->
   <delete id="deleteRabat" parameterType="map" >
    delete from goodsclassdiscount
    where   MemLevelID=#{classid} and DiscountShopID=#{shopid}
  </delete>
 
  

</mapper>