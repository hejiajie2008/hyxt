<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jfxy.dao.MemDao">


	<resultMap id="memMap" type="com.jfxy.pojo.Mem">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon Nov 30 
			16:11:47 CST 2015. -->
		<result column="MemID" property="memid" jdbcType="INTEGER" />
		<result column="MemCard" property="memcard" jdbcType="VARCHAR" />
		<result column="MemPassword" property="mempassword" jdbcType="VARCHAR" />
		<result column="MemName" property="memname" jdbcType="VARCHAR" />
		<result column="MemSex" property="memsex" jdbcType="TINYINT" />
		<result column="MemIdentityCard" property="memidentitycard"
			jdbcType="VARCHAR" />
		<result column="MemMobile" property="memmobile" jdbcType="VARCHAR" />
		<result column="MemPhoto" property="memphoto" jdbcType="VARCHAR" />
		<result column="MemBirthdayType" property="membirthdaytype"
			jdbcType="TINYINT" />
		<result column="MemBirthday" property="membirthday" jdbcType="VARCHAR" />
		<result column="MemIsPast" property="memispast" jdbcType="TINYINT" />
		<result column="MemPastTime" property="mempasttime" jdbcType="TIMESTAMP" />
		<result column="MemPoint" property="mempoint" jdbcType="INTEGER" />
		<result column="MemPointAutomatic" property="mempointautomatic"
			jdbcType="TINYINT" />
		<result column="MemMoney" property="memmoney" jdbcType="DECIMAL" />
		<result column="MemConsumeMoney" property="memconsumemoney"
			jdbcType="DECIMAL" />
		<result column="MemConsumeLastTime" property="memconsumelasttime"
			jdbcType="TIMESTAMP" />
		<result column="MemConsumeCount" property="memconsumecount"
			jdbcType="INTEGER" />
		<result column="MemEmail" property="mememail" jdbcType="VARCHAR" />
		<result column="MemAddress" property="memaddress" jdbcType="VARCHAR" />
		<result column="MemState" property="memstate" jdbcType="INTEGER" />
		<result column="MemRecommendID" property="memrecommendid"
			jdbcType="INTEGER" />
		<result column="MemLevelID" property="memlevelid" jdbcType="INTEGER" />
		<result column="MemShopID" property="memshopid" jdbcType="INTEGER" />
		<result column="MemCreateTime" property="memcreatetime"
			jdbcType="TIMESTAMP" />
		<result column="MemRemark" property="memremark" jdbcType="VARCHAR" />
		<result column="MemUserID" property="memuserid" jdbcType="INTEGER" />
		<result column="MemTelePhone" property="memtelephone" jdbcType="VARCHAR" />
		<result column="MemQRCode" property="memqrcode" jdbcType="VARCHAR" />
		<result column="MemProvince" property="memprovince" jdbcType="VARCHAR" />
		<result column="MemCity" property="memcity" jdbcType="VARCHAR" />
		<result column="MemCounty" property="memcounty" jdbcType="VARCHAR" />
		<result column="MemVillage" property="memvillage" jdbcType="VARCHAR" />
		<result column="MemQuestion" property="memquestion" jdbcType="VARCHAR" />
		<result column="MemAnswer" property="memanswer" jdbcType="VARCHAR" />
		<result column="MemWeiXinCard" property="memweixincard"
			jdbcType="VARCHAR" />
		<result column="MemCardNumber" property="memcardnumber"
			jdbcType="VARCHAR" />
		<result column="MemAttention" property="memattention" jdbcType="INTEGER" />
		<result column="MemWeiXinCards" property="memweixincards"
			jdbcType="VARCHAR" />
		<result column="ShopName" property="shopname" jdbcType="VARCHAR" />
		<result column="LevelName" property="levelname" jdbcType="VARCHAR" />
		<result column="UserName" property="username" jdbcType="VARCHAR" />
	</resultMap>


	<resultMap id="rptmemMap" type="com.jfxy.pojo.RptMem">
		<result column="MemID" property="memid" jdbcType="INTEGER" />
		<result column="MemCard" property="memcard" jdbcType="VARCHAR" />
		<result column="MemName" property="memname" jdbcType="VARCHAR" />
		<result column="ShopName" property="shopname" jdbcType="VARCHAR" />
		<association property="orderlogList" column="MemID"

			select="com.jfxy.dao.OrderlogDao.queryOrderlogbymemid" />
	</resultMap>




	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon Nov 30 
			16:11:47 CST 2015. -->
		MemID, MemCard, MemPassword, MemName, MemSex, MemIdentityCard,
		MemMobile, MemPhoto,
		MemBirthdayType, MemBirthday, MemIsPast, MemPastTime, MemPoint, MemPointAutomatic,
		MemMoney, MemConsumeMoney, MemConsumeLastTime, MemConsumeCount,
		MemEmail, MemAddress,
		MemState, MemRecommendID, MemLevelID, MemShopID, MemCreateTime, MemRemark,
		MemUserID,
		MemTelePhone, MemQRCode, MemProvince, MemCity, MemCounty, MemVillage, MemQuestion,
		MemAnswer, MemWeiXinCard, MemCardNumber, MemAttention, MemWeiXinCards
	</sql>

	<!-- create user -->
	<insert id="createMem" parameterType="com.jfxy.pojo.Mem">
		insert into mem (MemCard, MemPassword,
		MemName, MemSex, MemIdentityCard,
		MemMobile, MemPhoto, MemBirthdayType,
		MemBirthday, MemIsPast, MemPastTime,
		MemPoint, MemPointAutomatic, MemMoney,
		MemConsumeMoney, MemConsumeLastTime,
		MemConsumeCount, MemEmail, MemAddress,
		MemState, MemRecommendID, MemLevelID,
		MemShopID, MemCreateTime, MemRemark,
		MemUserID, MemTelePhone, MemQRCode,
		MemProvince, MemCity, MemCounty,
		MemVillage, MemQuestion, MemAnswer,
		MemWeiXinCard, MemCardNumber, MemAttention,
		MemWeiXinCards
		<if test="map!=null and map.size!=0">
			,
			<foreach collection="map.keys" item="item" separator=",">
				${item}
			</foreach>
		</if>

		)
		values (#{memcard}, #{mempassword},
		#{memname}, #{memsex}, #{memidentitycard},
		#{memmobile}, #{memphoto}, #{membirthdaytype},
		#{membirthday}, #{memispast}, #{mempasttime},
		#{mempoint}, #{mempointautomatic}, #{memmoney},
		#{memconsumemoney}, #{memconsumelasttime},
		#{memconsumecount}, #{mememail}, #{memaddress},
		#{memstate}, #{memrecommendid}, #{memlevelid},
		#{memshopid}, #{memcreatetime}, #{memremark},
		#{memuserid}, #{memtelephone}, #{memqrcode},
		#{memprovince}, #{memcity}, #{memcounty},
		#{memvillage}, #{memquestion}, #{memanswer},
		#{memweixincard}, #{memcardnumber}, #{memattention},
		#{memweixincards}
		<if test="map!=null and map.size!=0">
			,


			<foreach collection="map.values" item="item" separator=",">



				#{item}

			</foreach>
		</if>

		)

	</insert>

	<!-- updateUser -->
	<update id="updateMem" parameterType="com.jfxy.pojo.Mem">
		update mem
		<set>

			<if test="memcard != null">
				MemCard = #{memcard},
			</if>
			<if test="mempassword != null">
				MemPassword = #{mempassword},
			</if>
			<if test="memname != null">
				MemName = #{memname},
			</if>
			<if test="memsex != null">
				MemSex = #{memsex},
			</if>
			<if test="memidentitycard != null">
				MemIdentityCard = #{memidentitycard},
			</if>
			<if test="memmobile != null">
				MemMobile = #{memmobile},
			</if>
			<if test="memphoto != null">
				MemPhoto = #{memphoto},
			</if>
			<if test="membirthdaytype != null">
				MemBirthdayType = #{membirthdaytype},
			</if>
			<if test="membirthday != null">
				MemBirthday = #{membirthday},
			</if>
			<if test="memispast != null">
				MemIsPast = #{memispast},
			</if>
			<if test="mempasttime != null">
				MemPastTime = #{mempasttime},
			</if>
			<if test="mempoint != null">
				MemPoint = #{mempoint},
			</if>
			<if test="mempointautomatic != null">
				MemPointAutomatic = #{mempointautomatic},
			</if>
			<if test="memmoney != null">
				MemMoney = #{memmoney},
			</if>
			<if test="memconsumemoney != null">
				MemConsumeMoney = #{memconsumemoney},
			</if>
			<if test="memconsumelasttime != null">
				MemConsumeLastTime = #{memconsumelasttime},
			</if>
			<if test="memconsumecount != null">
				MemConsumeCount = #{memconsumecount},
			</if>
			<if test="mememail != null">
				MemEmail = #{mememail},
			</if>
			<if test="memaddress != null">
				MemAddress = #{memaddress},
			</if>
			<if test="memstate != null">
				MemState = #{memstate},
			</if>
			<if test="memrecommendid != null">
				MemRecommendID = #{memrecommendid},
			</if>
			<if test="memlevelid != null">
				MemLevelID = #{memlevelid},
			</if>
			<if test="memshopid != null">
				MemShopID = #{memshopid},
			</if>
			<if test="memcreatetime != null">
				MemCreateTime = #{memcreatetime},
			</if>
			<if test="memremark != null">
				MemRemark = #{memremark},
			</if>
			<if test="memuserid != null">
				MemUserID = #{memuserid},
			</if>
			<if test="memtelephone != null">
				MemTelePhone = #{memtelephone},
			</if>
			<if test="memqrcode != null">
				MemQRCode = #{memqrcode},
			</if>
			<if test="memprovince != null">
				MemProvince = #{memprovince},
			</if>
			<if test="memcity != null">
				MemCity = #{memcity},
			</if>
			<if test="memcounty != null">
				MemCounty = #{memcounty},
			</if>
			<if test="memvillage != null">
				MemVillage = #{memvillage},
			</if>
			<if test="memquestion != null">
				MemQuestion = #{memquestion},
			</if>
			<if test="memanswer != null">
				MemAnswer = #{memanswer},
			</if>
			<if test="memweixincard != null">
				MemWeiXinCard = #{memweixincard},
			</if>
			<if test="memcardnumber != null">
				MemCardNumber = #{memcardnumber},
			</if>
			<if test="memattention != null">
				MemAttention = #{memattention},
			</if>
			<if test="memweixincards != null">
				MemWeiXinCards = #{memweixincards},
			</if>

			<foreach collection="map" item="item" index="key" separator=",">


				<choose>
					<when test="item==''">
						${key}=null
					</when>
					<when test="item!=null">
						${key}=#{item}
					</when>
					<otherwise>
						${key}=#{item}
					</otherwise>
				</choose>


			</foreach>

		</set>

		where MemID=#{memid}
	</update>

	<!-- deleteUser -->
	<delete id="deleteMem" parameterType="long">
		DELETE FROM mem WHERE MemID
		= #{value}
	</delete>

	<!-- getUserCount -->
	<select id="queryMembyId" resultType="com.jfxy.pojo.Mem"
		parameterType="long">
		SELECT * FROM mem where MemID = #{value}
	</select>



	<!-- getUserCount -->
	<select id="getMemCount" parameterType="com.jfxy.pojo.form.MemFormBean"
		resultType="int">
		SELECT COUNT(*) FROM mem
		<where>
			<if test="memlevelid != null and memlevelid!=0">

				memlevelid=#{memlevelid}

			</if>
			<if test="memcard!=null and memcard!=''">
				and memcard like CONCAT( '%',#{memcard},'%')
			</if>
			<if test="memshopid!=null and memshopid!=''">
				and memshopid =#{memshopid}
			</if>
		</where>
	</select>

	<!-- getStoreList -->
	<select id="getMemList" parameterType="com.jfxy.pojo.form.MemFormBean"
		resultMap="memMap">
		SELECT mem.*,sysshop.ShopName,memlevel.LevelName,sysuser.UserName FROM
		mem left join sysshop on mem.MemShopID=sysshop.ShopID left join
		memlevel on mem.MemLevelID=memlevel.LevelID left join sysuser on
		mem.MemUserID=sysuser.UserID
		<where>
			<if test="memlevelid != null and memlevelid!=0">

				memlevelid=#{memlevelid}

			</if>
			<if test="memcardl!=null and memcardl!=''">
				and memcard like CONCAT( '%',#{memcard},'%')
			</if>
			<if test="memcard!=null and memcard!=''">
				and memcard=#{memcard}
			</if>
			<if test="memshopid!=null and memshopid!=''">
				and memshopid =#{memshopid}
			</if>

			<if test="memshopids!=null and memshopids.size!=0">
				and memshopid in
				<foreach collection="memshopids" item="item" index="index"
					separator="," open="(" close=")">
					#{item}
				</foreach>


			</if>
		</where>
		LIMIT #{firstResult},#{pageSize}
	</select>





	<!-- updateUser -->
	<update id="updateMemMoney" parameterType="com.jfxy.pojo.Mem">
		update mem
		<set>

			<if test="memcard != null">
				MemCard = #{memcard},
			</if>
			<if test="mempassword != null">
				MemPassword = #{mempassword},
			</if>
			<if test="memname != null">
				MemName = #{memname},
			</if>
			<if test="memsex != null">
				MemSex = #{memsex},
			</if>
			<if test="memidentitycard != null">
				MemIdentityCard = #{memidentitycard},
			</if>
			<if test="memmobile != null">
				MemMobile = #{memmobile},
			</if>
			<if test="memphoto != null">
				MemPhoto = #{memphoto},
			</if>
			<if test="membirthdaytype != null">
				MemBirthdayType = #{membirthdaytype},
			</if>
			<if test="membirthday != null">
				MemBirthday = #{membirthday},
			</if>
			<if test="memispast != null">
				MemIsPast = #{memispast},
			</if>
			<if test="mempasttime != null">
				MemPastTime = #{mempasttime},
			</if>
			<if test="mempoint != null">
				MemPoint = MemPoint+#{mempoint},
			</if>
			<if test="mempointautomatic != null">
				MemPointAutomatic = #{mempointautomatic},
			</if>
			<if test="memmoney != null">
				MemMoney = MemMoney+#{memmoney},
			</if>
			<if test="memconsumemoney != null">
				MemConsumeMoney = MemConsumeMoney+ #{memconsumemoney},
			</if>
			<if test="memconsumelasttime != null">
				MemConsumeLastTime = #{memconsumelasttime},
			</if>
			<if test="memconsumecount != null">
				MemConsumeCount = MemConsumeCount+ #{memconsumecount},
			</if>
			<if test="mememail != null">
				MemEmail = #{mememail},
			</if>
			<if test="memaddress != null">
				MemAddress = #{memaddress},
			</if>
			<if test="memstate != null">
				MemState = #{memstate},
			</if>
			<if test="memrecommendid != null">
				MemRecommendID = #{memrecommendid},
			</if>
			<if test="memlevelid != null">
				MemLevelID = #{memlevelid},
			</if>
			<if test="memshopid != null">
				MemShopID = #{memshopid},
			</if>
			<if test="memcreatetime != null">
				MemCreateTime = #{memcreatetime},
			</if>
			<if test="memremark != null">
				MemRemark = #{memremark},
			</if>
			<if test="memuserid != null">
				MemUserID = #{memuserid},
			</if>
			<if test="memtelephone != null">
				MemTelePhone = #{memtelephone},
			</if>
			<if test="memqrcode != null">
				MemQRCode = #{memqrcode},
			</if>
			<if test="memprovince != null">
				MemProvince = #{memprovince},
			</if>
			<if test="memcity != null">
				MemCity = #{memcity},
			</if>
			<if test="memcounty != null">
				MemCounty = #{memcounty},
			</if>
			<if test="memvillage != null">
				MemVillage = #{memvillage},
			</if>
			<if test="memquestion != null">
				MemQuestion = #{memquestion},
			</if>
			<if test="memanswer != null">
				MemAnswer = #{memanswer},
			</if>
			<if test="memweixincard != null">
				MemWeiXinCard = #{memweixincard},
			</if>
			<if test="memcardnumber != null">
				MemCardNumber = #{memcardnumber},
			</if>
			<if test="memattention != null">
				MemAttention = #{memattention},
			</if>
			<if test="memweixincards != null">
				MemWeiXinCards = #{memweixincards},
			</if>
		</set>

		where MemID=#{memid}
	</update>
	<select id="validateMemCardpassword" parameterType="map" resultType="int">
		select count(*)  from mem where memid=#{memid} and MemPassword=#{mempassword}
	</select>





	<select id="validateMemCard" parameterType="String" resultType="int">
		select count(*) from mem where memcard=#{value}
	</select>
	<select id="validateMobile" parameterType="String" resultType="int">
		select count(*) from mem
		<if test="value != ''">
			where memmobile=#{value}
		</if>
	</select>



	<!-- create user -->
	<insert id="createMemsjzx" parameterType="com.jfxy.pojo.Mem">
		insert into mem (MemCard, MemPassword,
		MemName, MemSex, MemIdentityCard,
		MemMobile, MemPhoto, MemBirthdayType,
		MemBirthday, MemIsPast, MemPastTime,
		MemPoint, MemPointAutomatic, MemMoney,
		MemConsumeMoney, MemConsumeLastTime,
		MemConsumeCount, MemEmail, MemAddress,
		MemState, MemRecommendID, MemLevelID,
		MemShopID, MemCreateTime, MemRemark,
		MemUserID, MemTelePhone, MemQRCode,
		MemProvince, MemCity, MemCounty,
		MemVillage, MemQuestion, MemAnswer,
		MemWeiXinCard, MemCardNumber, MemAttention,
		MemWeiXinCards)
		values (#{memcard}, #{mempassword},
		#{memname}, #{memsex}, #{memidentitycard},
		#{memmobile}, #{memphoto}, #{membirthdaytype},
		#{membirthday}, #{memispast}, #{mempasttime},
		#{mempoint}, #{mempointautomatic}, #{memmoney},
		#{memconsumemoney}, #{memconsumelasttime},
		#{memconsumecount}, #{mememail}, #{memaddress},
		#{memstate}, #{memrecommendid}, #{memlevelid},
		#{memshopid}, #{memcreatetime}, #{memremark},
		#{memuserid}, #{memtelephone}, #{memqrcode},
		#{memprovince}, #{memcity}, #{memcounty},
		#{memvillage}, #{memquestion}, #{memanswer},
		#{memweixincard}, #{memcardnumber}, #{memattention},
		#{memweixincards})
	</insert>




	<!-- pageOrderList -->
	<select id="pageOrderList" parameterType="com.jfxy.pojo.form.MemFormBean"
		resultMap="memMap">
		select
		mem.MemPoint,mem.MemCard,mem.MemName,mem.MemConsumeMoney,mem.MemMoney,mem.MemLevelID,mem.MemShopID
		from mem
		left join memlevel on mem.MemLevelID=memlevel.LevelID left join sysshop on
		sysshop.ShopID=mem.MemShopID

		<where>
			<if test="memlevelid != null and memlevelid!=0">

				memlevelid=#{memlevelid}

			</if>
			<if test="memcardl!=null and memcardl!=''">
				and memcard like CONCAT( '%',#{memcard},'%')
			</if>
			<if test="memcard!=null and memcard!=''">
				and memcard=#{memcard}
			</if>
			<if test="memshopid!=null and memshopid!=''">
				and memshopid =#{memshopid}
			</if>

			<if test="memshopids!=null and memshopids.size!=0">
				and memshopid in
				<foreach collection="memshopids" item="item" index="index"
					separator="," open="(" close=")">
					#{item}
				</foreach>


			</if>

		</where>

		order by mempoint desc

		LIMIT #{firstResult},#{pageSize}
	</select>


	<!-- updateUser -->
	<update id="updateMemCard" parameterType="com.jfxy.pojo.Mem">
		update mem
		<set>

			<if test="memcard != null">
				MemCard = #{memcard},
			</if>
			<if test="mempassword != null">
				MemPassword = #{mempassword},
			</if>

			<if test="memcardnumber != null">
				MemCardNumber = #{memcardnumber},
			</if>

		</set>

		where MemID=#{memid}
	</update>






	<insert id="createMemsplfk" parameterType="com.jfxy.pojo.SendCards">
		insert into mem
		(MemCard,
		MemPassword,MemPoint,MemMoney,MemState,MemLevelID,MemShopID,MemCreateTime,MemRemark,MemUserID,MemConsumeLastTime)
		values

		<foreach collection="listCard" item="item" separator=",">
			( #{item}, #{pwd},
			#{mempoint},#{memmoney},#{memstate},#{memlevel},#{shopid},now(),#{remark},#{userid},now())

		</foreach>

	</insert>


	<insert id="batchCreateMem" parameterType="com.jfxy.pojo.Batch">
		insert into mem (MemCard, MemPassword,
		MemName, MemSex, MemIdentityCard,
		MemMobile, MemPhoto, MemBirthdayType,
		MemBirthday, MemIsPast, MemPastTime,
		MemPoint, MemPointAutomatic, MemMoney,
		MemConsumeMoney, MemConsumeLastTime,
		MemConsumeCount, MemEmail, MemAddress,
		MemState, MemRecommendID, MemLevelID,
		MemShopID, MemCreateTime, MemRemark,
		MemUserID, MemTelePhone, MemQRCode,
		MemProvince, MemCity, MemCounty,
		MemVillage, MemQuestion, MemAnswer,
		MemWeiXinCard, MemCardNumber, MemAttention,
		MemWeiXinCards
		<if test="head!=null and head.size!=0">
			,
			<foreach collection="head.keys" item="item" separator=",">
				${item}
			</foreach>
		</if>
		) values
		<foreach collection="listvalue" item="item" separator=",">
			(#{item.memcard}, #{item.mempassword},
			#{item.memname}, #{item.memsex}, #{item.memidentitycard},
			#{item.memmobile}, #{item.memphoto}, #{item.membirthdaytype},
			#{item.membirthday}, #{item.memispast}, #{item.mempasttime},
			#{item.mempoint}, #{item.mempointautomatic}, #{item.memmoney},
			#{item.memconsumemoney}, #{item.memconsumelasttime},
			#{item.memconsumecount}, #{item.mememail}, #{item.memaddress},
			#{item.memstate}, #{item.memrecommendid}, #{item.memlevelid},
			#{item.memshopid}, #{item.memcreatetime}, #{item.memremark},
			#{item.memuserid}, #{item.memtelephone}, #{item.memqrcode},
			#{item.memprovince}, #{item.memcity}, #{item.memcounty},
			#{item.memvillage}, #{item.memquestion}, #{item.memanswer},
			#{item.memweixincard}, #{item.memcardnumber}, #{item.memattention},
			#{item.memweixincards}
			<if test="item.map!=null and item.map.size!=0">
				,
				<foreach collection="item.map.values" item="mitem"
					separator=",">
					#{mitem}
				</foreach>
			</if>
			)
		</foreach>
	</insert>


	<update id="updateMemlock" parameterType="com.jfxy.pojo.Mem">
		update mem
		set


		MemState = #{memstate}


		where MemID=#{memid}
	</update>


	<update id="updateMemDelayTime" parameterType="com.jfxy.pojo.Mem">
		update mem
		set


		MemPastTime = #{mempasttime}


		where MemID=#{memid}
	</update>



	<!-- getUserCount -->
	<select id="countRptMem" parameterType="com.jfxy.pojo.form.RptMemFormBean"
		resultType="int">
		SELECT COUNT(*) FROM mem
		<where>

			<if test="memcard!=null and memcard!=''">
				memcard like CONCAT( '%',#{memcard},'%')
			</if>
			<if test="memshopid!=null and memshopid!=''">
				and memshopid =#{memshopid}
			</if>
		</where>
	</select>



	<select id="pageListRptMem" parameterType="com.jfxy.pojo.form.RptMemFormBean"
		resultMap="rptmemMap">
		SELECT mem.MemID, mem.MemCard,mem.MemName,sysshop.ShopName FROM mem
		left join sysshop on mem.MemShopID=sysshop.ShopID

		<where>

			<if test="memshopid!=null and memshopid!=''">
				memshopid =#{memshopid}
			</if>


		</where>
		LIMIT #{firstResult},#{pageSize}
	</select>


</mapper>
